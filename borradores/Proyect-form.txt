import { useState, useEffect } from 'react'
import PropTypes from 'prop-types'
import useProjects from '../hooks/useProjects'

const initialForm = {
  name: '',
  description: '',
  deadline: '',
  customer: ''
}
function ProjectsForm({ projectToEdit = initialForm }) {
  const [form, setForm] = useState(projectToEdit)

  const { createProject, editProject } = useProjects()

  useEffect(() => {
    if (projectToEdit._id) {
      setForm({
        ...projectToEdit,
        deadline: projectToEdit.deadline.split('T')[0]
      })
    }
  }, [])

  const handleChange = (e) => {
    setForm({
      ...form,
      [e.target.name]: e.target.value
    })
  }

  const handleSubmit = async (e) => {
    e.preventDefault()
    const { name, description, deadline, customer } = form

    if (!form._id) {
      await createProject({ name, description, deadline, customer })
    } else {
      await editProject({ ...form, deadline })
    }

    setForm(initialForm)
  }

  return (
    <form
      className=' mx-auto flex  w-full max-w-xl flex-col justify-center space-y-5 rounded-md bg-white p-4 pb-10 pt-5'
      onSubmit={(e) => handleSubmit(e)}
    >
      <div>
        <label className='block font-bold text-primary-blue' htmlFor='name'>
          Nombre
        </label>
        <input
          type='text'
          id='name'
          name='name'
          placeholder='Nombre del proyecto...'
          value={form.name}
          className='block w-full border border-l-0 border-r-0 border-t-0 border-b-primary-blue bg-white px-2 py-1.5 caret-primary-blue shadow-sm outline-none placeholder:text-primary-blue sm:text-sm sm:leading-6'
          onChange={(e) => handleChange(e)}
          autoComplete='off'
          required
        />
      </div>
      <div>
        <label
          className='block font-bold text-primary-blue'
          htmlFor='description'
        >
          Description
        </label>
        <textarea
          id='description'
          name='description'
          placeholder='DescripciÃ³n del proyecto...'
          value={form.description}
          className='block h-[37px] w-full border border-l-0 border-r-0 border-t-0 border-b-primary-blue bg-white px-2 py-1.5 caret-primary-blue shadow-sm outline-none placeholder:text-primary-blue sm:text-sm sm:leading-6'
          onChange={(e) => handleChange(e)}
          autoComplete='off'
          required
        />
      </div>
      <div>
        <label className='block font-bold text-primary-blue' htmlFor='deadline'>
          Deadline
        </label>
        <input
          type='date'
          id='deadline'
          name='deadline'
          placeholder='dd/mm/yy'
          value={form.deadline}
          className='date__input block w-full cursor-pointer appearance-none border border-l-0 border-r-0 border-t-0 border-b-primary-blue bg-white px-2 py-1.5 text-primary-blue caret-primary-blue shadow-sm outline-none placeholder:text-primary-blue sm:text-sm sm:leading-6 '
          onChange={(e) => handleChange(e)}
          autoComplete='off'
          required
        />
      </div>
      <div>
        <label className='block font-bold text-primary-blue' htmlFor='customer'>
          Cliente
        </label>
        <input
          type='text'
          id='customer'
          name='customer'
          placeholder='Nombre del cliente...'
          value={form.customer}
          className='block w-full appearance-none border border-b border-l-0 border-r-0 border-t-0 border-primary-blue bg-white px-2 py-1.5 shadow-sm outline-none placeholder:text-primary-blue focus:bg-white active:bg-white sm:text-sm sm:leading-6'
          onChange={(e) => handleChange(e)}
          autoComplete='off'
          required
        />
      </div>
      <div>
        <input
          type='submit'
          value={form._id ? 'Editar proyecto' : 'Crear proyecto'}
          className='mt-[10px] block w-full cursor-pointer rounded-lg bg-primary-blue px-2 py-1.5 font-bold text-gray-300 caret-primary-blue shadow-sm outline-none transition-colors duration-300 placeholder:text-primary-blue hover:bg-custom-cyan hover:text-primary-blue sm:text-sm sm:leading-6'
        />
      </div>
    </form>
  )
}

ProjectsForm.propTypes = {
  projectToEdit: PropTypes.object
}

export default ProjectsForm
